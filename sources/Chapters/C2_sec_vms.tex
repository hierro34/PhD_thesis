Let us consider a FE partition $\mathcal{T}_h$ of the domain $\Omega$ from which we can construct conforming finite dimensional spaces for the velocity $\mathcal{V}_{0,h} \subset \mathcal{V}_0$, and for the pressure $\mathcal{Q}_{0,h}\subset \mathcal{Q}_0$. 

It is well known that the Galerkin FE approximation \Eq{C2_NS_weak_discrete} has numerical instabilities for high mesh Reynolds number problems, i.e., when the nonlinear convective term dominates the viscous term. Another drawback of that formulation is the discrete \textit{inf-sup} condition that must be satisfied by the pair $\mathcal{V}_{0,h} \times\mathcal{Q}_{0,h}$ in order to have a well-posed problem with bounded pressure. These difficulties are overcome by using the VMS approach, introduced by Hughes in \cite{hughes,hughes}, and that is stated as follows.

Let us consider a two-scale decomposition of spaces $\mathcal{V}_0$ and $\mathcal{Q}_0$ such that $$\mathcal{V}_0=\mathcal{V}_{0,h}\oplus\widetilde{\mathcal{V}}_0$$ and $$\mathcal{Q}_0=\mathcal{Q}_{0,h}\oplus\widetilde{\mathcal{Q}}_0,$$ where $\widetilde{\mathcal{V}}_0$ and $\widetilde{\mathcal{Q}}_0$ are infinite-dimensional spaces that complete the FE spaces in $\mathcal{V}_0$ and $\mathcal{Q}_0$, respectively. Hereinafter the subscript $(\cdot)_h$ will denote the FE component and the tilde $\widetilde{(\cdot)}$ the subgrid component. Applying the two-scale decomposition to \Eq{C2_NS_weak} we obtain a discrete problem
\begin{align}
\label{eq-C2_NS_discrete}
(\partial_t\u_h,\v_h)+(\partial_t\tilde{\u},\v_h)&+B(\a;[\u_h,p_h],[\v_h,q_h])\\\nonumber
&+\left(\tilde{\u},\mathcal{L}_{\a}^*(\v_h,q_h)\right)_h-\left(\tilde{p},\nabla\cdot\v_h\right)=\left<\f,\v_h\right>,
\end{align}
where $(\cdot,\cdot)_h=\sum_{K\in\mathcal{T}_h}(\cdot,\cdot)_K$ is the sum of scalar products (\ref{eq:scalar_product}) over each element $K$ of the partition $\mathcal{T}_h$, and
\begin{equation}
\label{eq-C2_adjoint}
\mathcal{L}_{\a}^*(\v_h,q_h):=-\nu\nabla^2\v_h-\a\cdot\nabla\v_h-\nabla q_h
\end{equation}
is the formal of the adjoint operator of the momentum equation. The term involving the adjoint operator comes from an elementwise integration by parts of the terms involving the subscales, in which the boundary terms 
$\left( \v_{h},\nu \n\cdot \nabla \tilde{\u}\right)_{\partial h}$ and
$\left( q_{h},\n\cdot \tilde{\u}\right)_{\partial h}$
have been neglected (the subscript ${\partial h}$ is used to denote the sum over all elements of the integral on the boundary of each element). It also involves the approximation 
$b(\a,\tilde{\u},\u_h) \approx -(\tilde{\u},\a\cdot\nabla\v_h)$
which implies neglecting 
$\left( \v_{h},\n\cdot \a \tilde{\u}\right)_{\partial h}$ and
$(\tilde{\u},\nabla\cdot\a\v_h)$. 
These approximations are discussed in  \cite{codina_time_2007} together with the choice of $\a$ which defines the type of scale splitting (linear or nonlinear), also discussed below.

The discrete problem depends on $\tilde{\u} \in \widetilde{\mathcal{V}}_0$ and on $\tilde{p}\in \widetilde{\mathcal{Q}}_0$,  $\widetilde{\mathcal{V}}_0$ and $\widetilde{\mathcal{Q}}_0$ being infinite-dimensional. Therefore, the equations for $\tilde{\u}$ and $\tilde{p}$ obtained after applying the two-scale decomposition cannot be directly solved, but some modeling steps are needed to obtain a feasible method. Considering the subscale as a time-dependent variable of the problem (see below) and approximating the Navier-Stokes operator by two stabilization parameters $\tau_m^{-1}$ and $\tau_c^{-1}$ (see for example \cite{codina_time_2007}), the fine scale problem can be written as
\begin{align}
\label{eq-C2_velo_sgs}
\partial_t\tilde{\u}+\tau_m^{-1}\tilde{\u}=\mathcal{P}(\R_u),\\
\label{eq-C2_press_sgs}
\tau_c^{-1}\tilde{p}=\mathcal{P}(R_p).
\end{align}
In \Eq{C2_velo_sgs}-\Eq{C2_press_sgs} $\mathcal{P}$ denotes the projection onto the space of subscales, which is discussed below. In turn, the vector $\R$ is the residual of the Navier-Stokes equations \Eq{NS_strong_momentum}-\Eq{NS_strong_continuity}, defined as $\R=[\R_u,R_p]^T$, with
\begin{align}
\label{eq-C2_Ru}
%&\R_u=\f-\left(\partial_t\u_h+N((\u_h+\tilde{\u}),\u_h)+\nabla p_h \right),\\
%&\R_u=\f-\left(\partial_t\u_h+ \a \cdot \nabla \u_h + \nabla p_h \right),\\
&\R_u=\f-\partial_t\u_h-\mathcal{L}_{\a}(\u_h,p_h),\\
\label{eq-C2_Rp}
&R_p=-\nabla\cdot\u_h.
\end{align}
where
\begin{equation}
\label{eq-C2_operator}
\mathcal{L}_{\a}(\v_h,q_h):=-\nu\nabla^2\v_h+\a\cdot\nabla\v_h+\nabla q_h
\end{equation}
%and $N((\u_h+\tilde{\u}),\u_h)=(\u_h+\tilde{\u})\cdot\nabla\u_h$ is the convective term. 
Finally, the expressions of the stabilization parameter $\tau_m$ is 
\begin{align}
\label{eq-C2_tau_m}
&\tau_m=\left(\frac{c_1\nu}{h^2}+\frac{c_2|\a|}{h}\right)^{-1},
\end{align}
whereas we consider two possible definitions of $\tau_c$, viz. $\tau_c = 0$ (which implies $\tilde{p} = 0$) and 
\begin{align}
\label{eq-C2_tau_c}
&\tau_c=\frac{h^2}{c_1\tau_m},
\end{align}
where $h$ is the mesh size and $c_1$ and $c_2$ are algorithmic constants. Let us comment on expression \Eq{C2_tau_m}:
\begin{itemize}
\item The influence of the constants $c_1$ and $c_2$ is discussed in \Sec{C4_effect_const}. A theoretical way to determine them would be to impose that the numerical dissipation they introduce be equal to the molecular dissipation in turbulent regimes, as explained in~\cite{guasch-codina-13}. 
\item The definition of $\tau_m$ in \Eq{C2_tau_m} is not standard, in the sense that the one used often depends on the time step size of the time discretization, $\delta t$. Instead of \Eq{C2_tau_m}, $\tau_m^{-1}=\frac{1}{\delta t} + \frac{c_1\nu}{h^2}+\frac{c_2|\a|}{h}$ is more often considered (see, e.g., \cite{Hsu2010,gamnitzer_time-dependent_2010}). We refer to \Sec{C4_small_time_step} for a more detailed discussion about this topic. Likewise, other expressions with the same asymptotic behavior in terms of $h$, $\nu$ and $|\a|$ can also be employed.
\item Expression \Eq{C2_tau_m} corresponds to linear isotropic elements. If elements of order $p$ are used ($p$ is not the pressure, here), $c_1$ must be replaced by $c_1 p^4$ and $c_2$ by $c_2 p$. For anisotropic elements, the definition of $h$ within each element is not obvious. A possibility is explained in \cite{Principe2010}.
\end{itemize}

In the following three sections we discuss the particular ingredients of our VMS models. A different summary can also be found in \cite{Codina-chap-2011}, together with some numerical experiments. 

\subsection{The dynamics of the subscales}
\label{subsec-C2_dyn}
Stabilized formulations were originally developed for steady convection-diffusion \cite{Brooks_1982} and Stokes \cite{Douglas_1989,Hughes_1986_5} problems. As the numerical instabilities have a spatial nature, the time dependency of the subscales was not considered, and the standard choice \cite{Hughes2000,hughes_large_2001,bazilevs_variational_2007} was to take 
\begin{equation}
\label{eq-C2_static_sgs}
\tilde{\u}=\tau_m \mathcal{P}(\R_u),
\end{equation}
that is, to neglect the temporal derivative of the subscales in \Eq{C2_velo_sgs}. In this case, the subscales are called quasi-static in what follows.

The subscale as a time dependent variable of the problem was introduced in \cite{codina_stabilized_2002,codina_time_2007}. It gives rise to important properties like commutativity of space and time discretization, stability without restrictions on the time step size \cite{codina_time_2007,Badia2009a} and, combined with orthogonal subscales, to convergence towards weak solutions of the Navier-Stokes equations \cite{Badia2013Convergence} and the possibility of predicting backscatter \cite{Codina-chap-2011,Principe2009}. 

Equation \Eq{C2_velo_sgs} can be analytically integrated to give
\begin{equation}
\label{eq-C2_exact_sgs}
\tilde{\u}(t^*)=\tilde{\u}(0) + \mu^{-1}(t^*) \int_0^{t^*} \mu(t) \mathcal{P}\R_u {\rm d}t, \quad \quad \mu(s)=\exp \int_0^s \tau^{-1}(t){\rm d}t,
\end{equation}
where it is explicitly seen that the subscale is a function of the residual but also of the flow history. In practice this integration is performed numerically, as described below.

\subsection{(Non)linear scale splitting}
\label{subsec-C2_nl}
The original VMS formulation \cite{hughes_multiscale_1995,hughes_variational_1998} was developed having linear problems in mind and its extension to the Navier-Stokes equations was implicitly based on a ``linearization'', fixing the advection velocity and applying the multiscale splitting to the rest of the terms. A nonlinear scale splitting was used in \cite{Hughes2000,hughes_large_2001} together with an explicit resolution of the small scales in which a Smagorinsky damping was introduced. A nonlinear scale splitting with modeled subscales was used in \cite{codina_stabilized_2002, bazilevs_variational_2007} and in \cite{codina_time_2007}, where it was shown that it leads to global conservation of momentum. We therefore consider both options
%The vector $\a$ appearing in (\ref{eq:bilinear}) and (\ref{eq:adjoint}) is the advection velocity of the convective term. It can be defined in two different ways depending if we use a linear or a nonlinear scheme for the subscales definition. That is, 
\begin{align}
\label{eq-C2_a_lin}
&\a=\u_h&&\mbox{for linear subscales},\\
\label{eq-C2_a_nl}
&\a=\u_h+\tilde{\u}&&\mbox{for nonlinear subscales}.
\end{align}

\begin{remark}
\label{rem-skewsym}
When we use the nonlinear definition for the advection velocity, $\a=\u_h+\tilde{\u}$, the skew-symmetric term \textit{type 2} \Eq{C2_b_skew2} in the FE equation \Eq{C2_NS_weak_discrete} reads: 
\begin{equation}
\label{eq-C2_b_skew2_aux1}
b(\a,\u_h,\v_h)=((\u_h+\tilde{\u})\cdot\nabla\u_h,\v_h)+\frac{1}{2}(\u_h\cdot\v_h,\nabla\cdot\u_h)+\frac{1}{2}(\u_h\cdot\v_h,\nabla\cdot\tilde{\u}).
\end{equation}
The last term is not well-defined, since it includes derivatives of the discontinuous subscale $\tilde{\u}$. One possibility is to neglect it (as previously done with other similar terms when arriving to \Eq{C2_NS_weak_discrete}), which implies
\begin{equation}
b(\a,\u_h,\u_h)=-\frac{1}{2}(|\u_h|^2,\nabla\cdot\tilde{\u}),
\end{equation}
the same result obtained when the non conservative form is used.
By contrast, the skew-symmetric term \textit{type 1} in the FE equation \Eq{C2_NS_weak_discrete} reads
\begin{equation}
\label{eq-C2_b_skew1_aux1}
b(\a,\u_h,\v_h)=\frac{1}{2}((\u_h+\tilde{\u})\cdot\nabla\u_h,\v_h)-\frac{1}{2}((\u_h+\tilde{\u})\cdot\u_h,\nabla\cdot\v_h)
\end{equation}
from where
\begin{equation}
b(\a,\u_h,\u_h)=0.
\end{equation}
% and we can not use the FE shape function derivatives to approximate it because the subscales are on another space. Then we avoid this problem by neglecting this term. 
%Therefore, the skew-symmetric term \textit{type 2} implementation for a nonlinear definition of the subscales will be
%\begin{equation}
%\label{eq:b_skew2_aux2}
%b(\a,\u_h,\v_h)=(\a\cdot\nabla\u_h,\v)+\frac{1}{2}(\u_h\cdot\v_h,\nabla\cdot\a)-\frac{1}{2}(\u_h\cdot\v_h,\nabla\cdot\tilde{\u}).
%\end{equation}
In Subsection \ref{subsec-C4_DHIT} we will see the influence of the two forms of the convective term on the results.
It is worth noting that the same approximations have been introduced in all cases to implement $b(\a,\tilde{\u},\u_h)$, but these approximations are taken into account in the (usual) energy estimates of \Sec{C4_energy}.
%Note that \textit{type 2} is the standard choice.
\end{remark}

\begin{remark}
At the continuous level, the different expressions of the convective term are also equivalent to the so called conservation form
\begin{align}
b(\u,\v,\w)= -(\u\otimes \v,\nabla\w).\nonumber
\end{align}
In the discrete problem, the nonlinear scale splitting leads to the following terms in the momentum equation:
\begin{align}
b(\a,\u_h +\tilde\u,\v_h)= - (\u_h\otimes\u_h, \nabla\v_h)
- (\u_h\otimes\tilde\u, \nabla\v_h)- (\tilde\u\otimes\u_h, \nabla\v_h)
- (\tilde\u\otimes\tilde\u, \nabla\v_h).\label{eq:nonconconv}
\end{align}
Even if this is not exactly what we get using the non-conservative or skew-symmetric forms because of the approximation error, this allows us to interpret the different contributions arising from the nonlinear scale splitting. As it is explained in \cite{Codina-chap-2011}, from (\ref{eq:nonconconv}) we can identify the contributions from the cross stresses, the Reynolds stresses and the subgrid scale tensor. 
\end{remark}

\subsection{The space for the subscales}
\label{subsec-C2_oss}
The selection of the space for the approximation of the subscales determines the projection $\mathcal{P}$ appearing in the right-hand side of \Eq{C2_velo_sgs} and \Eq{C2_press_sgs}. The first option, already considered in \cite{Hughes2000,hughes_large_2001,bazilevs_variational_2007} and named Algebraic Subgrid Scale (ASGS) in \cite{codina_stabilization_2000} is to take the subscales in the space of the residuals, that is,
%method is characterized by the following projection definition:
\begin{equation}
\label{eq-C2_P_ASGS}
\mathcal{P}:=\mathbf{I}.
\end{equation}
Another possibility introduced in \cite{codina_stabilization_2000} is to consider the space of the subscales orthogonal to the FE space. The main motivation of the method is that a stability estimate for the projection onto the FE space of the pressure and/or the convective terms can already be obtained in the standard Galerkin method and therefore the only ``missing'' part is the orthogonal one. The Orthogonal Subscales (OSS) method is then characterized by the following projection definition:
\begin{equation}
\label{eq-C2_P_OSS}
\mathcal{P}:=\Pi_h^\bot=\mathbf{I}-\Pi_h,
\end{equation}
where $\Pi_h$ is the projection onto the FE space. With this choice, the residual of the momentum equation does not depend on $\partial_t\u_h$. Likewise, $\mathcal{P}(\f)$ in this case is only well defined for $\f\in L^2(\Omega)^d$. In the case of minimum regularity, $\f\in H^{-1}(\Omega)^d$, this term can be simply neglected without upsetting the accuracy of the method.

In fact, with this choice, the orthogonality between the space of subscales and the FE space is only guaranteed when the stabilization parameters are constant. If this is not the case, the method is still optimally convergent \cite{Codina_2008a} but this property is lost. In order to have truly orthogonal subscales, \emph{which guarantees a proper separation of the FE and the subgrid scale kinetic energies} (see \Sec{C4_energy}) a slight modification of the projection $\Pi_h$ is needed (see \cite{Codina_2008a}). We will use two different weighted projections: one for the velocity subscales ($\Pi_m$) in \Eq{C2_velo_sgs} and another for the pressure subscales ($\Pi_c$) in \Eq{C2_press_sgs}. We define the weighted projections $\Pi_m$ and $\Pi_c$ such that given any vector $\w\in\mathcal{V}_0$ and any scalar $r\in\mathcal{Q}_0$ we have
\begin{align}
\label{eq-C2_Pi_tau_m}
&(\tau_m\Pi_m(\w),\v_h)=(\tau_m\w,\v_h)&&\forall\v_h\in\mathcal{V}_{0,h},\\
\label{eq-C2_Pi_tau_c}
&(\tau_c\Pi_c(r),q_h)=(\tau_cr,q_h)&&\forall q_h\in\mathcal{Q}_{0,h}.
\end{align}
These definitions guarantee the orthogonality between the FE and subscale spaces in the case of static subscales, that is, neglecting temporal derivatives in \Eq{C2_velo_sgs}. It then follows that the term containing the temporal derivative of the subscale in the FE equation \Eq{C2_NS_discrete} also vanishes.

However, if the dynamic version of the method is used, the weight of the projection \Eq{C2_Pi_tau_m} must be conveniently modified to ensure the mentioned orthogonality. As it can be seen in \Eq{C2_exact_sgs}, the definition of the weight depends on the time integration strategy, as explicitly stated in \Sec{C4_discrete}.